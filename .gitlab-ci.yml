stages:
  - deploy

workflow:
  rules:
    - if: $CI_COMMIT_REF_NAME =~ /from-src\/.*$/
      when: never

deploy:
  image: curlimages/curl:latest
  stage: deploy
  script:
    - version=$([[ -z "$CI_COMMIT_TAG" ]] && echo "branch=$CI_COMMIT_REF_NAME" || echo "tag=$CI_COMMIT_TAG")
    - 'curl --header "Job-Token: $CI_JOB_TOKEN" --data $version "${CI_API_V4_URL}/projects/$CI_PROJECT_ID/packages/composer"'
